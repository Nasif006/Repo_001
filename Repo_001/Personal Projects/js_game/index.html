<head>
    <style>
        * {
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    
    <div style="position: relative; display: inline-block;">

        <div style="position: absolute; display: flex; width: 100%; align-items: center; padding: 20px;">
            <!-- Player health-->
            <div style="width: 100%; height: 40px; background-color: yellow;"></div>

            <!-- Timer-->
            <div style="width: 100px; height: 100px; background-color: red; flex-shrink: 0;"></div>

            <!-- enemy health-->
            <div id="enemyHealthBar" style="width: 100%; height: 40px; background-color: yellow;"></div>

        </div>
        
        <canvas></canvas>
    </div>
        

    <script>
        const canvas = document.querySelector('canvas')
    const c = canvas.getContext('2d')

    canvas.width = 1024
    canvas.height = 576

    c.fillRect (0, 0, canvas.width, canvas.height)

    const gravity = 0.7

    class sprite {
        constructor({position, velocity, color='blue', offset}){
            this.position= position
            this.velocity= velocity
            this.height = 150
            this.width = 50
            this.color= color
            this.lastkey
            this.attackBox = {
                position : {
                    x : this.position.x,
                    y : this.position.y
                },
                offset : offset,
                width : 100,
                height : 50
            }
            this.isAttacking = false
        }

        draw (){
            c.fillStyle = this.color
            
            c.fillRect(this.position.x, this.position.y, this.width, this.height)

            //attack Box
            if(this.isAttacking === true) {
                c.fillStyle = 'yellow'
                c.fillRect(this.attackBox.position.x, this.attackBox.position.y, this.attackBox.width, this.attackBox.height)
            }
        }

        update (){
            this.draw()

            this.attackBox.position.x = this.position.x + this.attackBox.offset.x
            this.attackBox.position.y = this.position.y

            this.position.x += this.velocity.x
            this.position.y += this.velocity.y

            if (this.position.y + this.height + this.velocity.y >= canvas.height){
                this.velocity.y = 0
            }else{
                this.velocity.y += gravity
            }

        }

        attack (){
            this.isAttacking = true;
            setTimeout(() => {
                this.isAttacking = false;
            },100)
        }
    }

    const player = new sprite ({
        position : {x : 100, y : 0},
        velocity : {x : 0, y : 0},
        offset : { x : 0, y : 0},
        color : 'green'})

    const enemy = new sprite ({
        position : {x : 900, y : 0},
        velocity : {x : 0, y : 0},
        offset : { x : -50, y : 0},
        color : 'red'})


    console.log(player);

    const keys = {
        a : {
            pressed : false
        },
        d : {
            pressed : false
        },

        ArrowLeft : {
            pressed : false
        },
        ArrowRight : {
            pressed : false
        }
        
    }

    function rectangularCollision ({rectangle1, rectangle2}) {
        return (
            rectangle1.attackBox.position.x + rectangle1.attackBox.width >= rectangle2.position.x && rectangle1.attackBox.position.x <= rectangle2.position.x + rectangle2.width && rectangle1.attackBox.position.y + rectangle1.attackBox.height >= rectangle2.position.y && rectangle1.attackBox.position.y <=rectangle2.position.y + rectangle2.height
        )
    }

    function animate () {
        window.requestAnimationFrame(animate)
        c.fillStyle = 'black'
        c.fillRect(0, 0, canvas.width, canvas.height)
        player.update()
        enemy.update()

        player.velocity.x = 0
        enemy.velocity.x = 0
        
        //player movement
        if (keys.a.pressed && player.lastkey === 'a') {
            player.velocity.x = -5
        }else if (keys.d.pressed && player.lastkey === 'd') {
            player.velocity.x = 5
        }

        //enemy movement
        if (keys.ArrowLeft.pressed && enemy.lastkey === 'ArrowLeft') {
            enemy.velocity.x = -5
        }else if (keys.ArrowRight.pressed && enemy.lastkey === 'ArrowRight') {
            enemy.velocity.x = 5
        }

        //detect collision
        if ( rectangularCollision ({
            rectangle1 : player,
            rectangle2 : enemy
            }) && 
            player.isAttacking){
            enemy.color='orange'
            player.isAttacking = false
            document.querySelector('#enemyHealthBar').style.width = '50%'
        }else{
            enemy.color='red'
        }

        if ( rectangularCollision ({
            rectangle1 : enemy,
            rectangle2 : player
            }) && 
            enemy.isAttacking){
            player.color='orange'
            enemy.isAttacking = false
        }else{
            player.color='green'
        }
    }

    animate ()

    window.addEventListener("keydown", (event) => {
        switch (event.key){
            case 'd' :
                keys.d.pressed = true
                player.lastkey = 'd'
                break
            
            case 'a' :
                keys.a.pressed = true
                player.lastkey = 'a'
                break

            case 'w' :
                player.velocity.y = -20
                break

            case ' ' :
                player.attack()
                break
            //enemy keys

            case 'ArrowRight' :
                keys.ArrowRight.pressed = true
                enemy.lastkey = 'ArrowRight'
                break
            
            case 'ArrowLeft' :
                keys.ArrowLeft.pressed = true
                enemy.lastkey = 'ArrowLeft'
                break

            case 'ArrowUp' :
                enemy.velocity.y = -20
                break
            
            case '0' :
                enemy.attack()
                break
                    
        }
        console.log(event.key)
    })


    window.addEventListener("keyup", (event) => {
        switch (event.key){
            case 'd' :
                keys.d.pressed = false
                break
            
            case 'a' :
                keys.a.pressed = false
                break

            //enemy
            case 'ArrowRight' :
                keys.ArrowRight.pressed = false
                break
            
            case 'ArrowLeft' :
                keys.ArrowLeft.pressed = false
                break

        }
    })
    </script>


</body>